<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', 'Cairo', sans-serif; background-color: #f4f6f9; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; direction: rtl !important;}
    header { background-color: #fff; padding: 10px 20px; box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; height: 60px; z-index: 1100;}
    .app-title { display: flex; align-items: center; gap: 12px; font-size: 1.7rem; font-weight: 700; color: #2c3e50; user-select: none;}
    .app-title i { font-size: 2rem; color: #0d6efd;}
    #dateTime { color: #6c757d; font-size: 1rem; font-weight: 600; user-select: none; min-width: 220px; text-align: left;}
    #langToggle { background: linear-gradient(135deg, #4dabf7, #0d6efd); border: none; color: white; font-weight: 600; font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 8px; box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3); transition: background 0.3s ease; user-select: none; direction: ltr;}
    #langToggle:hover { background: linear-gradient(135deg, #0d6efd, #4dabf7);}
    #hamburgerBtn { display: none; background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #0d6efd; direction: ltr;}
    .sidebar { position: fixed; top: 60px; right: 0; width: 240px; bottom: 0; background: #ffffff; border-left: 1px solid #dee2e6; padding: 20px 10px; display: flex; flex-direction: column; gap: 12px; overflow-y: auto; box-shadow: inset 0 0 10px #e1e5eb; transition: transform 0.3s ease; z-index: 1000;}
    .sidebar a { display: flex; align-items: center; gap: 10px; padding: 12px 16px; font-weight: 600; font-size: 1rem; color: #2c3e50; border-radius: 12px; text-decoration: none; background: linear-gradient(145deg, #f0f4ff, #d9e3ff); transition: all 0.25s ease; user-select: none;}
    .sidebar a i { font-size: 1.3rem; color: #0d6efd; flex-shrink: 0;}
    .sidebar a .emoji { font-size: 1.4rem; transition: transform 0.3s ease; user-select: none; flex-shrink: 0;}
    .sidebar a:hover, .sidebar a.active { background: linear-gradient(135deg, #4a7fff, #a6c1ff); color: #fff; animation: pulse 0.6s ease;}
    .sidebar a.active { pointer-events: none; }
    .sidebar a:hover .emoji { animation: wiggle 0.4s ease-in-out; transform-origin: center bottom; }
    main#mainContent { margin-right: 240px; padding: 30px 25px; overflow-y: auto; background-color: #f4f6f9; flex-grow: 1; height: calc(100vh - 60px);}
    .settings-section { max-width: 700px; margin: 30px auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.07);}
    .sections-grid { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 18px;}
    .section-btn { display: flex; align-items: center; gap: 8px; padding: 13px 20px; font-size: 1.08rem; font-weight: 700; background: #e8f0fe; border: 1.5px solid #0d6efd; color: #0d6efd; border-radius: 10px; cursor: pointer; transition: background 0.2s, color 0.2s; min-width: 160px; user-select: none;}
    .section-btn:hover, .section-btn.active { background: #0d6efd; color: #fff;}
    .sound-settings-form { margin-top: 20px; border: 1px solid #b6d4fe; border-radius: 10px; background: #f8fbff; padding: 18px 16px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 9999; min-width: 320px; max-width: 95vw; box-shadow: 0 8px 32px #0002;}
    .sound-settings-form label { font-weight: 600; margin-bottom: 5px; display: block; }
    .sound-settings-form select, .sound-settings-form input[type="number"], .sound-settings-form input[type="time"] { width: 100%; padding: 7px 10px; margin-bottom: 12px; border-radius: 7px; border: 1px solid #b6d4fe; font-size: 1rem;}
    .sound-settings-form button { background: #0d6efd; color: #fff; border: none; border-radius: 8px; padding: 8px 24px; font-weight: 700; font-size: 1rem; margin-top: 8px;}
    .sound-settings-form button:hover { opacity: 0.9; }
    .preview-btn { background: #fff; color: #0d6efd; border: 1px solid #0d6efd; font-weight: bold; border-radius: 7px; margin-right: 8px; padding: 3px 13px; font-size: 1rem;}
    .preview-btn:hover { background: #0d6efd; color: #fff; }
    .sound-modal-bg { position: fixed; inset: 0; background: #0003; z-index: 9998;}
    .repeat-infinite-option {color: #e11d48; font-weight: bold;}
    @media (max-width: 900px) { .sections-grid { gap: 8px; } .section-btn { min-width: 110px; font-size: 0.98rem; padding: 10px 8px; } }
    @media (max-width: 700px) { main#mainContent { padding: 10px 2px; } .settings-section { padding: 10px 3px; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
    @keyframes wiggle { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(6deg); } 50% { transform: rotate(-6deg); } 75% { transform: rotate(4deg); } }
  </style>
</head>
<body>
  <header>
    <button id="hamburgerBtn" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"><i class="bi bi-list"></i></button>
    <div id="dateTime">ğŸ—“ï¸ --:--</div>
    <div class="app-title"><i class="bi bi-volume-up-fill"></i> <span id="pageTitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª</span></div>
    <button id="langToggle" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©"><i class="bi bi-globe"></i> <span id="langText">English</span></button>
  </header>
  <nav class="sidebar" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©">
    <a href="home_timer.html"><i class="bi bi-house-door-fill"></i><span class="emoji">ğŸ </span> <span data-key="navHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
    <a href="index.html"><i class="bi bi-box-seam"></i><span class="emoji">ğŸ“¦</span> <span data-key="navShowProducts">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span></a>
    <a href="add_timer.html" class="active" aria-current="page"><i class="bi bi-clock-history"></i><span class="emoji">â±ï¸</span> <span data-key="navAddTimer">Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù‚Øª</span></a>
    <a href="timer_table.html"><i class="bi bi-table"></i><span class="emoji">ğŸ“‹</span> <span data-key="navTimerTable">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª</span></a>
    <a href="actions_timers.html"><i class="bi bi-tools"></i><span class="emoji">âš™ï¸</span> <span data-key="navActions">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</span></a>
    <a href="print_options.html"><i class="bi bi-printer-fill"></i><span class="emoji">ğŸ–¨ï¸</span> <span data-key="navPrintOptions">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</span></a>
    <a href="sound_settings.html"><i class="bi bi-volume-up-fill"></i><span class="emoji">ğŸ”Š</span> <span data-key="navSoundSettings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª</span></a>
    <a href="alerts.html"><i class="bi bi-bell-fill"></i><span class="emoji">ğŸ””</span> <span data-key="navAlerts">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</span></a>
    <a href="reports.html"><i class="bi bi-bar-chart-line-fill"></i><span class="emoji">ğŸ“ˆ</span> <span data-key="navReports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span></a>
  </nav>
  <main id="mainContent">
    <div class="settings-section">
      <h3 style="text-align:center;" id="soundSettingsTitle">ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
      <button id="showSectionsBtn" class="btn btn-primary w-100 mb-3" type="button">
        <i class="bi bi-list-ul"></i> <span id="showSectionsText">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
      </button>
      <div class="sections-grid" id="sectionsGrid"></div>
    </div>
  </main>
  <script>
    // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙƒÙ…Ø§ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ùƒ
    const sectionsList = [
      {en: "Frozen items", ar: "Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¬Ù…Ø¯Ø©"},
      {en: "Bakery Items", ar: "Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®Ø¨ÙˆØ²Ø§Øª"},
      {en: "Preparation Tables", ar: "Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªØ­Ø¶ÙŠØ±"},
      {en: "Prepared Salads", ar: "Ø§Ù„Ø³Ù„Ø·Ø§Øª Ø§Ù„Ù…Ø­Ø¶Ø±Ø©"},
      {en: "Thawing products", ar: "Ù…Ù†ØªØ¬Ø§Øª Ø¥Ø°Ø§Ø¨Ø© Ø§Ù„Ø«Ù„Ø¬"},
      {en: "Secondary Expirations", ar: "Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"},
      {en: "Chilled items", ar: "Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¨Ø±Ø¯Ø©"},
      {en: "Hand Sanitizer Timer", ar: "Ù…Ø¤Ù‚Øª Ù…Ø¹Ù‚Ù… Ø§Ù„ÙŠØ¯ÙŠÙ†"},
      {en: "Cleaning Items", ar: "Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ"},
      {en: "Store Licenses", ar: "ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…ØªØ§Ø¬Ø±"},
      {en: "Staff Health Card", ar: "Ø¨Ø·Ø§Ù‚Ø© ØµØ­Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"},
      {en: "Staff End Of Contract", ar: "Ù†Ù‡Ø§ÙŠØ© Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"},
      {en: "commissary Items", ar: "Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…ÙÙˆØ¶ÙŠØ©"},
      {en: "Pepsi Items", ar: "Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠØ¨Ø³ÙŠ"},
      {en: "Milk shake", ar: "Ø§Ù„Ù„Ø¨Ù† Ø§Ù„Ù…Ø®ÙÙˆÙ‚"},
      {en: "ice cream", ar: "Ø¨ÙˆØ¸Ø©"},
      {en: "cheese", ar: "Ø¬Ø¨Ù†"},
      {en: "Counter", ar: "Ø¹Ø¯Ø§Ø¯"},
      {en: "Managers Tasks", ar: "Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†"},
      {en: "Dry Items", ar: "Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¬Ø§ÙØ©"}
    ];

    // Ø§Ù„ØªØ±Ø¬Ù…Ø©
    const translations = {
      ar: {
        pageTitle: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª",
        navHome: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        navShowProducts: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        navAddTimer: "Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ù‚Øª",
        navTimerTable: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª",
        navActions: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬",
        navPrintOptions: "Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©",
        navSoundSettings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª",
        navAlerts: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡",
        navReports: "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",
        soundSettingsTitle: "ğŸ”Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ù„Ù„Ø£Ù‚Ø³Ø§Ù…",
        showSections: "Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…",
        save: "Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
        close: "Ø¥ØºÙ„Ø§Ù‚",
        selectSound: "Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª:",
        repeat: "Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØªÙƒØ±Ø§Ø±:",
        repeatForever: "Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØªÙƒØ±Ø§Ø±",
        notifyTime: "Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (Ø³Ø§Ø¹Ø©:Ø¯Ù‚ÙŠÙ‚Ø©):",
        preview: "Ù…Ø¹Ø§ÙŠÙ†Ø©",
        saved: "ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø¨Ù†Ø¬Ø§Ø­!",
        noSections: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªØ§Ø­Ø©.",
        defaultSound: "Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ"
      },
      en: {
        pageTitle: "Sound Settings",
        navHome: "Home",
        navShowProducts: "Show Products",
        navAddTimer: "Add Timer",
        navTimerTable: "Timer Table",
        navActions: "Product Actions",
        navPrintOptions: "Print Options",
        navSoundSettings: "Sound Settings",
        navAlerts: "Alerts Settings",
        navReports: "Reports",
        soundSettingsTitle: "ğŸ”Š Sound Settings for Sections",
        showSections: "Show Sections",
        save: "Save Settings",
        close: "Close",
        selectSound: "Select Sound:",
        repeat: "Repeat Count:",
        repeatForever: "Repeat Forever",
        notifyTime: "Notify Time (hh:mm):",
        preview: "Preview",
        saved: "Sound settings saved successfully!",
        noSections: "No sections available.",
        defaultSound: "Default Sound"
      }
    };

    // Ù…ÙƒØªØ¨Ø© Ø£ØµÙˆØ§Øª Ù‚ÙˆÙŠØ© (Ù‚ØµÙŠØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø©)
    const sounds = [
      { value: "beep", label: "Beep", src: "https://cdn.pixabay.com/audio/2022/10/16/audio_12b5fae5e7.mp3" },
      { value: "bell", label: "Bell", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" },
      { value: "alert", label: "Alert", src: "https://cdn.pixabay.com/audio/2022/11/16/audio_12c7c7f7c9.mp3" },
      { value: "ding", label: "Ding", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" },
      { value: "notify", label: "Notify", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" },
      { value: "buzzer", label: "Buzzer", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" },
      { value: "pop", label: "Pop", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" },
      { value: "success", label: "Success", src: "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b4cfa.mp3" }
    ];

    // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª Ù„Ù„Ø°Ø§ÙƒØ±Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
    const howlsCache = {};
    function preloadAllSounds() {
      sounds.forEach(sound => {
        howlsCache[sound.value] = new Howl({
          src: [sound.src],
          preload: true,
          html5: false
        });
      });
    }
    preloadAllSounds();

    let currentLang = localStorage.getItem("appLang") || "ar";
    let infiniteInterval = null;
    let previewHowl = null;

    function applyLanguage(lang) {
      document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";
      document.documentElement.lang = lang;
      document.getElementById("langText").textContent = lang === "ar" ? "English" : "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©";
      document.getElementById("pageTitle").textContent = translations[lang].pageTitle;
      document.getElementById("soundSettingsTitle").textContent = translations[lang].soundSettingsTitle;
      document.getElementById("showSectionsText").textContent = translations[lang].showSections;
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        if (translations[lang][key]) el.textContent = translations[lang][key];
      });
    }

    function getSoundSettings() {
      try { return JSON.parse(localStorage.getItem('soundSettings') || '{}'); } catch { return {}; }
    }
    function saveSoundSettings(settings) {
      localStorage.setItem('soundSettings', JSON.stringify(settings));
    }

    function renderSectionsGrid() {
      const grid = document.getElementById("sectionsGrid");
      grid.innerHTML = "";
      if (sectionsList.length === 0) {
        grid.innerHTML = `<div class="alert alert-warning mt-2">${translations[currentLang].noSections}</div>`;
        return;
      }
      sectionsList.forEach(sectionObj => {
        const section = sectionObj[currentLang] || sectionObj.ar || sectionObj.en;
        const btn = document.createElement('button');
        btn.className = 'section-btn';
        btn.type = "button";
        btn.textContent = section;
        btn.oncontextmenu = function(e) {
          e.preventDefault();
          showSoundSettings(section);
        };
        grid.appendChild(btn);
      });
    }

    // Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
    function showSoundSettings(section) {
      removeSoundModal();
      const settings = getSoundSettings();
      const secSettings = settings[section] || { sound: sounds[0].value, repeat: 1, time: "08:00" };
      // Ø®Ù„ÙÙŠØ© Ù…ÙˆØ¯Ø§Ù„
      const modalBg = document.createElement("div");
      modalBg.className = "sound-modal-bg";
      modalBg.onclick = removeSoundModal;
      document.body.appendChild(modalBg);

      // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const form = document.createElement("form");
      form.className = "sound-settings-form";
      form.onsubmit = function(e) { saveSectionSoundSettings(e, section); };
      form.innerHTML = `
        <h5 style="margin-bottom:18px;">ğŸ”Š ${translations[currentLang].soundSettingsTitle} <span style="color:#0d6efd">${section}</span></h5>
        <label>${translations[currentLang].selectSound}</label>
        <div style="display:flex;align-items:center;gap:7px;">
          <select name="sound" id="soundSelect" style="flex:1;">
            ${sounds.map(s => `<option value="${s.value}" ${s.value === secSettings.sound ? 'selected' : ''}>${s.label}</option>`).join('')}
          </select>
          <button type="button" class="preview-btn" onclick="previewSound()">${translations[currentLang].preview}</button>
        </div>
        <label>${translations[currentLang].repeat}</label>
        <select name="repeat" id="repeatSelect">
          ${[...Array(10).keys()].map(i => `<option value="${i+1}" ${secSettings.repeat===(i+1)?'selected':''}>${i+1}</option>`).join('')}
          <option value="infinite" class="repeat-infinite-option" ${secSettings.repeat==="infinite"?'selected':''}>${translations[currentLang].repeatForever} (âˆ)</option>
        </select>
        <label>${translations[currentLang].notifyTime}</label>
        <input type="time" name="time" value="${secSettings.time}" required>
        <div style="text-align:center;margin-top:10px;">
          <button type="submit"><i class="bi bi-save"></i> ${translations[currentLang].save}</button>
          <button type="button" class="btn btn-secondary ms-2" onclick="removeSoundModal()">${translations[currentLang].close}</button>
        </div>
      `;
      document.body.appendChild(form);

      // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚ÙˆÙ Ø£Ùˆ Ø§Ù„ØªØºÙŠÙŠØ±
      const select = form.querySelector('#soundSelect');
      select.addEventListener('mousemove', function(e) {
        const options = Array.from(this.options);
        const rect = this.getBoundingClientRect();
        const y = e.clientY - rect.top;
        const optionHeight = rect.height / options.length;
        const idx = Math.floor(y / optionHeight);
        if (options[idx]) {
          playSound(options[idx].value);
        }
      });
      select.addEventListener('change', function() {
        playSound(this.value);
      });
      select.addEventListener('mouseleave', function() {
        if (previewHowl) { previewHowl.stop(); previewHowl = null; }
      });
    }

    window.removeSoundModal = function() {
      document.querySelectorAll('.sound-modal-bg').forEach(e => e.remove());
      document.querySelectorAll('.sound-settings-form').forEach(e => e.remove());
      if (previewHowl) { previewHowl.stop(); previewHowl = null; }
    };

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙˆØ±ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    function playSound(value) {
      if (previewHowl) { previewHowl.stop(); previewHowl = null; }
      if (howlsCache[value]) {
        previewHowl = howlsCache[value];
        previewHowl.stop();
        previewHowl.volume(1);
        previewHowl.play();
      }
    }
    window.previewSound = function(val) {
      const select = document.getElementById('soundSelect');
      const value = val || (select ? select.value : sounds[0].value);
      playSound(value);
    };

    window.saveSectionSoundSettings = function(e, section) {
      e.preventDefault();
      const form = e.target;
      const sound = form.sound.value;
      let repeat = form.repeat.value;
      repeat = repeat === "infinite" ? "infinite" : parseInt(repeat, 10);
      const time = form.time.value;
      const settings = getSoundSettings();
      settings[section] = { sound, repeat, time };
      saveSoundSettings(settings);
      removeSoundModal();
      alert(translations[currentLang].saved);
    };

    function updateDateTime() {
      const now = new Date();
      const locale = currentLang === "ar" ? 'ar-EG' : 'en-US';
      const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
      const timeOptions = { hour: "2-digit", minute: "2-digit", hour12: false };
      const dateStr = now.toLocaleDateString(locale, options);
      const timeStr = now.toLocaleTimeString(locale, timeOptions);
      document.getElementById("dateTime").textContent = `ğŸ—“ï¸ ${dateStr} - â° ${timeStr}`;
    }

    document.addEventListener("DOMContentLoaded", function() {
      applyLanguage(currentLang);
      updateDateTime();
      setInterval(updateDateTime, 60000);

      document.getElementById("langToggle").addEventListener("click", function() {
        currentLang = currentLang === "ar" ? "en" : "ar";
        localStorage.setItem("appLang", currentLang);
        applyLanguage(currentLang);
        renderSectionsGrid();
      });

      const hamburgerBtn = document.getElementById("hamburgerBtn");
      const sidebar = document.querySelector(".sidebar");
      hamburgerBtn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
      });
      document.addEventListener("click", (e) => {
        if (sidebar.classList.contains("open") && !sidebar.contains(e.target) && !hamburgerBtn.contains(e.target)) {
          sidebar.classList.remove("open");
        }
      });

      document.getElementById("showSectionsBtn").onclick = renderSectionsGrid;
      renderSectionsGrid();
    });
  </script>
  <script>
    window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>
